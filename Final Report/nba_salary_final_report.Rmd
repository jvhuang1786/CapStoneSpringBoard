---
title: "final_report_nba_salary"
author: "Justin Huang"
date: "2/7/2019"
output: 
  html_document:
    keep_md: yes
  pdf_document: default
---

```{r echo = FALSE}
setwd("/users/justinvhuang/desktop/nba_stat_salaries")
data<-read.csv("2000_2018_nba.csv")
data<- data[,-1]
```

```{r echo = FALSE, message = FALSE, warning =FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
library(data.table)
library(ggrepel)
library(directlabels)
library(gridExtra)
library(PerformanceAnalytics)
library(psych)
library(lmtest)
library(sandwich)
library(caret)
library(rattle)
library(car)
options(max.print = 999999999)
options(scipen=12)
```

#Constructing a template for NBA salary negotiations


### **Introduction:**

The purpose of this report is to establish a reference point for NBA players, agents and teams in salary negotiation talks. It looks at the 3-point trend in the NBA, foreign player salaries, modern 7ft player salaries, reference for award salaries, the mid-level exception and runs a multiple linear regression in attempt to predict salary. Data was collected from the 2000 to 2018 NBA season.

### **Data Collection:**

The data was collected from a variety of sources. The data after the wrangling and cleaning contained 7978 observations with 57 variables. Salary was collected from Hoopshype a NBA third party news site that reports latest player transaction and NBA salary negotiations. 

The 2000 salary data was collected from Patricia Bender’s website. Land of Basketball provided NBA award data. Player statistics was collected from basketball reference, and college and age data were collected from NBA STATs. The 4 NBA collective bargaining agreements and NBA contract structure were used as a reference to better understand salary negotiations between the Players Association and all 30 NBA owners. All the data was merged using a full_join() by player_name and named 2000_2018_nba.csv.
    

Below are links to the data sources:

  [NBA STATS](https://stats.nba.com)（The official NBA statistics site for player and team statistics）

  [Basketball Reference](https://www.basketball-reference.com)（A sports reference website that has collected historical data on all sports.） 

  [Patricia Bender](https://www.eskimo.com/~pbender/) (An individual who analyzed the state of the last 17 years of the CBA and provided salary information to Basketball Reference) 
	
  [CBA](http://www.cbafaq.com/salarycap.htm ) (Information on the changes and agreements of the collective bargaining agreements.)

  [NBA Contract](https://atlhawksfanatic.github.io/NBA-CBA/uniform-player-contract.html#bonuses ) (Analyzing an NBA contract explaining the different types of contracts as well as NBA player pensions.)  
	
  [Hoops Hype](https://hoopshype.com ) (NBA news site, and salary reference) 
	
  [Land of Basketball](https://www.landofbasketball.com ) (Website containing historical information on awards and nominations of the NBA) 
    
### **Data Wrangling and Cleaning:**

A few of the main challenges with this data was it was collected from different sources. Three main data sources were used, Hoopshype for salary, basketball reference for player statistics and NBA STATs for age and college information. The salary data was collected using rvest to webscrape the data tables from their website. Other data was collected through CSV files. 

The main challenge with cleaning the data was that each source had different spellings for player names. Some sources had the suffixes for the name others did not, some used the passport name of the player while other sources used the American basketball name. Since each year had different players that could have a Jr or an apostrophe in their name each season was cleaned individual before using a rbind to combine them all.

Other challenges with data cleaning was to remove duplicate players, injured players, players that were legally on contract with the team but were no longer playing and players that were traded that showed up more than once in a season.

After doing a full_join() on salary, player statistic, age and college information there were still some NA’s for salary and player statistics since the number of players for each season was inconsistent for the three data sources. The reason for this is because some of the sources decided to include players that were on 2-way or 10-day contracts. 2-way contracts are for teams that are in the NBA G league. (The NBA development league.) 10- day contracts, are also contracts for players that play in the G league as well as for a way for the 30 teams to sign players left on the market to test contracts before fully committing to a player for the entire season.

Missing salary and statistic data were added back in from Patricia Benders website and basketball reference. Originally the 2019 season was also included, but I decided to remove it since the season was still ongoing at this time. I then also ran a filter to remove players that did not play more than 5 games, 5 minutes per game and did not score 1 point per game.

In the time period from 2000 to 2018, the Vancouver Grizzlies became the Memphis Grizzlies, the Seattle Supersonics became the Oklahoma City Thunder, the New Jersey Nets became the Brooklyn Nets, the Charlotte Hornets became the New Orleans Pelicans, Charlotte under the leadership of Michael Jordan got their team back and got their team back but were named the Bobcats before switching the name back to the Hornets.
I chose to change the old team names to the newer one. I used grepl and gsub to perform this task. For example, from 2000 to 2007 the Seattle Supersonics team would be changed to the Oklahoma City Thunder. While, this is inaccurate it won’t affect the players data and stats, but it will keep track of team win history through 2000 to 2018.


###**Data Exploration:** 

Doing an initial exploration on salary we find that the CBA structure of the 25-35 Max player contract causes the salary distribution to be skewed right. Which awards star or all-star caliber players on teams to get a majority of a team’s salary.  

```{r echo = FALSE}
#salary
ggplot(data, aes(x = salary)) + 
  geom_density(col = 'black', fill = 'green') +
  ggtitle("Salary distribution")
```

The salary structure in the NBA is a little rigid as each CBA usually lists a salary scale according to basketball related income for veterans, rookies, players signed to the mid-level exception, biannual exception, 10 day, 2- way contracts and minimum contracts.

For max salary contract players, the new 2017 CBA allows players to access the ability to get 35 percent of the that seasons salary cap. The circumstances are making an All-NBA team twice within 3 years before signing the contract or win MVP or defensive player of the year to be able to access the full max contract. The Derrick Rose rule which was set in the 2011 CBA now allows rookies to access the full max earlier now by winning MVP or making an All-NBA team twice. By not winning these awards or not playing 7-9 years in the league a player can only access 25-30 percent of the current salary cap.


Another trend is the huge salary bump in 2015 for most NBA players.  

```{r echo = FALSE}
gasol<- data %>% subset(name == "Pau Gasol", select= c(PlayerYear:SalCap))
ggplot(gasol, aes(Age, salary, color = MinGames)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green") + 
  ggtitle("Gasol Lifecycle")
```

```{r echo = FALSE}
crawford <- data %>% subset(name == "Jamal Crawford", select= c(PlayerYear:SalCap)) 
#salary in relation to the age and mins per game 
ggplot(crawford, aes(Age, salary, color = MinGames)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green") +
  ggtitle("Crawford Life Cycle")
```

Looking at Spanish basketball player Pau Gasol who has made a few all-star teams we can see that at 35 he should be reaching the end of his NBA life cycle. Going into the 2016 season he received a huge salary boost. We can also see a similar trend for Jamal Crawford who has won multiple sixth man of the year awards also received a huge salary boost during the same year.

The sudden payment to NBA players with the huge salary cap boost can be mainly attributed to the new TV contract that the NBA signed.


  [BRI](https://www.investopedia.com/articles/investing/070715/nbas-business-model.asp) – introduction to basketball related income
  
  [TV Deal](http://www.nba.com/article/2017/04/05/nba-tv-ratings-promising-first-year-new-deal) -news article on huge NBA TV deal 

```{r echo = FALSE}
#TeamSal and Salcap 

ggplot(data,aes(SalCap, tmsalary)) + 
  geom_point() +
  ggtitle("Team salary vs Salary Cap")

```

```{r echo = FALSE}
data %>% ggplot(aes(PlayerYear, SalCap)) + 
  geom_point() +
  ggtitle("Player Year vs Salary Cap")
```

Player salary is attached to the salary cap each season which is dictated by basketball related income. Due to the increase in popularity and spread of social media and ways the league can earn revenue this could explain the huge spike in player salaries beginning after 2015. Many teams because of this anticipation of the 2017 CBA signed their players to contract structures dictated by the 2011 CBA. Thus, they gave more money to players than they usually would during the 2016 and 2017 season. A total of 2 billion dollars was spent during the 2016 free agency market.

**The salary of a 3-point shooter**

The trend in the NBA shows that more players over the years have been attempting more 3’s and taking less 2’s. Below the red dots are two-point attempts over the years and the blue dots are 3-point attempts.    

```{r echo = FALSE}
shot_att <-data %>% group_by(PlayerYear) %>% summarize(two_att = mean(two_att), three_att = mean(three_att), two = mean(two), three =mean(three))
ggplot(shot_att, aes(x =PlayerYear)) +
  geom_point(aes(y= two_att), colour = "red") +
  geom_point(aes(y= three_att), colour = "blue") +
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018)) + 
  ylab("Shot Attempts") +
  ggtitle("The Threes vs Twos Attempts")
```

There is no strong correlation at the moment between salary and threes. However, the 3-point revolution according to many news sites started after the 2015 Championship where a jump shooting team finally won a championship.

``` {r echo = FALSE}
pairs.panels(data[c("salary", "three","three_att", "three_per")])
```

There is a weak correlation between salary and threes made (0.28), three-point attempts(0.28) and three-point percentage(0.04). However, if we look at winning compared to three pointers and separate players who made three 3pointers a game and those who did not we can see there is a big discrepancy in wins.

```{r echo = FALSE}
thr_win<-data %>%  group_by(PlayerYear) %>% filter(three >= 3) %>% summarize(meanW = mean(TeamWins,na.rm = T), 
                                                                             median(TeamWins,na.rm =T),
                                                                             max(TeamWins,na.rm = T), 
                                                                             min(TeamWins, na.rm = T))
```

From the table above we can see that in the later years after 2015 for players who made more than three 3’s a game were able to win on average 55 games and the minimum amount of wins is 36.  

```{r echo = FALSE}
thr_win
ggplot(thr_win, aes(PlayerYear, meanW)) + 
  geom_line() +
  ggtitle("Shooting more than three 3's win trend")
```


Looking at the chart we can see there was again a huge spike in 2015 for wins and making more than three 3’s.  In the past due to how the game was played differently with slashing guards and post up big men there was less emphasis on the 3-point shot. 

```{r echo = FALSE}
thr_lose<-data %>%  group_by(PlayerYear) %>% filter(three < 3) %>% summarize(meanW = mean(TeamWins,na.rm = T), 
                                                                             median(TeamWins,na.rm =T),
                                                                             max(TeamWins,na.rm = T), 
                                                                             min(TeamWins, na.rm = T))
```

Looking at the table for less than three 3’s a game we can see that the mean is around 41 games won.  With a min even as low as 7 wins.  

```{r echo = FALSE}
thr_lose
ggplot(thr_lose, aes(PlayerYear, meanW)) + 
  geom_line() +
  ggtitle("Taking Less than Three 3's a game")
```

If we look at the graph, we see the average wins for players who can’t make more than three 3’s is around 40 games.  The dip in 2012 is due to the shortened lock out season.  

After the 2015 season it showed players who made more than 3 three’s per game on average their teams won 55 games. While, teams who had players who made less than 3 three’s a game only won on average 40-42 games. Winning 40-42 games through the 2000-2018 season would normally only get you 8th seed in the east while you would be 9th or 10th seed in the west. Therefore, as a general manager you would want to keep a look out for these players who have the ability to make more than 3 three’s a game. Out of 7978 observations only 27 observations were able to do so. While only one observation Jason Richardson was the only player who did not make an All-NBA team. From a team’s perspective or an agent’s perspective then these players who have the ability to make more than 3 threes a game are valuable.

```{r echo = FALSE}
morethan3<-data %>% filter(three >= 3)
morethan3 %>% select(name, PlayerYear, salary, ppg, three) %>% head(n=10)
mean<-mean(morethan3$salary)
max<-max(morethan3$salary)
min<-min(morethan3$salary)
median<-median(morethan3$salary)
stdev<- sd(morethan3$salary)
dfmean3 <-data.frame()
dfmean3 <- cbind(rbind(mean,max,min,median,stdev))
colnames(dfmean3)[1] <- "Salary"
dfmean3
```

The average salary for the past 19 seasons is 14437429 which should be starting talks for a team if they are able to find a player who has this capability. However, if the player dictates terms and knows his value, he could possibly dictate probably twice this amount until there are more observations in the future and there are more players in the market who have the ability to make more than 3 threes a game.

```{r echo = FALSE, message = FALSE}
morethan3<-data %>% filter(three >= 3)
morethan3 %>% ggplot(aes(PlayerYear,salary, color = ppg)) + geom_smooth() +
  ggtitle("More than Three 3's a game Yearly Salary Trend")
```

Looking at the plot above in today’s NBA market a player who has the ability to make more than three 3’s a game could possibly command a salary above 20 million dollars a year. This type of contract is near close to the max and could vary depending on the number of years the player has played in the NBA.

Benefit: 

    Scarcity of players- 27 observations out of 7978 were only able to make three 3’s a game in a season!

Cost:

    Signing a player would be difficult and you would be most likely paying near the max money for this type of player and thus signing them to an unfavorable contract.  

    The trend analysis shows that more players are attempting 3’s hence this population of players being able to make more than 3 three’s a game might increase in the future causing the supply to go up and the price for these players to go down. 

**Modern Day 7fters NBA Salary** 

The average height of the NBA player did not decrease that much over the past 19 seasons.  
```{r include = FALSE , fig.width=14, fig.height=12}
#2018 average joe find the average joe for each year then rbind them 
AvgJoe_18<-data %>% filter(PlayerYear == 2018) %>% summarize(name = "AvgJoe_2018",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per = mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_17<-data %>% filter(PlayerYear == 2017) %>% summarize(name = "AvgJoe_2017",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_16<-data %>% filter(PlayerYear == 2016) %>% summarize(name = "AvgJoe_2016",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_15<-data %>% filter(PlayerYear == 2015) %>% summarize(name = "AvgJoe_2015",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_14<-data %>% filter(PlayerYear == 2014) %>% summarize(name = "AvgJoe_2014",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two/two_att),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_13<-data %>% filter(PlayerYear == 2013) %>% summarize(name = "AvgJoe_2013",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_12<-data %>% filter(PlayerYear == 2012) %>% summarize(name = "AvgJoe_2012",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_11<-data %>% filter(PlayerYear == 2011) %>% summarize(name = "AvgJoe_2011",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_10<-data %>% filter(PlayerYear == 2010) %>% summarize(name = "AvgJoe_2010",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_09<-data %>% filter(PlayerYear == 2009) %>% summarize(name = "AvgJoe_2009",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_08<-data %>% filter(PlayerYear == 2008) %>% summarize(name = "AvgJoe_2008",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_07<-data %>% filter(PlayerYear == 2007) %>% summarize(name = "AvgJoe_2007",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_06<-data %>% filter(PlayerYear == 2006) %>% summarize(name = "AvgJoe_2006",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_05<-data %>% filter(PlayerYear == 2005) %>% summarize(name = "AvgJoe_2005",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_04<-data %>% filter(PlayerYear == 2004) %>% summarize(name = "AvgJoe_2004",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_03<-data %>% filter(PlayerYear == 2003) %>% summarize(name = "AvgJoe_2003",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_02<-data %>% filter(PlayerYear == 2002) %>% summarize(name = "AvgJoe_2002",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_01<-data %>% filter(PlayerYear == 2001) %>% summarize(name = "AvgJoe_2001",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe_00<-data %>% filter(PlayerYear == 2000) %>% summarize(name = "AvgJoe_2000",height = mean(height_cm), weight =mean(weight_lb),
                                                             salary = mean(salary/((100+infl)/100)), plusMinus =mean(PlusMinus), age =mean(Age),
                                                             games = mean(Games), start = mean(started), mins =mean(MinGames),
                                                             fg=mean(FG), fg_att =mean(FG_att), fg_per =mean(FG_per),
                                                             three =mean(three), three_att = mean(three_att), three_per =mean(three/three_att),
                                                             two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                                             efg=mean(EFG), ft=mean(FT), ft_att =mean(FT_att), ft_per = mean(ft/ft_att),
                                                             o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                                             steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                                             ppg =mean(ppg))
AvgJoe<-rbind(AvgJoe_00,AvgJoe_01,AvgJoe_02,AvgJoe_03,AvgJoe_04,AvgJoe_05,AvgJoe_06,
              AvgJoe_07,AvgJoe_08,AvgJoe_09,AvgJoe_10,AvgJoe_11,AvgJoe_12,AvgJoe_13,
              AvgJoe_14,AvgJoe_15,AvgJoe_16,AvgJoe_17,AvgJoe_18)

AvgJoe["PlayerYear"]<- c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,
                         2014,2015,2016,2017,2018)
AvgJoe <-AvgJoe[,-1]


p1<-ggplot(AvgJoe, aes(PlayerYear, salary, color = ppg)) + geom_line()  +
  scale_colour_gradient(low = "red",high = "green") +
  ggtitle("Avg Joe relationship salary and ppg")
#number of points seems to dip after a bit maybe inefficient scoring 
p2<-ggplot(AvgJoe, aes(PlayerYear, salary, color = efg)) + geom_line()  +
  scale_colour_gradient(low = "red",high = "green") +
  ggtitle("Avg Joe relationship salary and EFG")

grid.arrange(p1, p2, ncol = 2)
#EFG wasn't really valuable in the early years but it slowly started gaining steam after 2015 


#the mean of the 19 seasons 

avgJoe19yrs<- AvgJoe %>%  summarize(name = "AvgJoe",height = mean(height), weight =mean(weight),
                                    salary = mean(salary), plusMinus =mean(plusMinus), age =mean(age),
                                    games = mean(games), start = mean(start), mins =mean(mins),
                                    fg=mean(fg), fg_att =mean(fg_att), fg_per =mean(fg_per),
                                    three =mean(three), three_att = mean(three_att), three_per =mean(three_per),
                                    two = mean(two), two_att=mean(two_att), two_per =mean(two_per),
                                    efg=mean(efg), ft=mean(ft), ft_att =mean(ft_att), ft_per = mean(ft_per),
                                    o_reb =mean(o_reb), d_reb =mean(d_reb), t_reb =mean(t_reb), assist =mean(assist),
                                    steal =mean(steal), block =mean(block), TO =mean(TO), fouls=mean(fouls),
                                    ppg =mean(ppg))
avgJoe19yrs
AvgJoe["Type"] <- "Avg"
```

The average height of the NBA player did not decrease that much over the past 19 seasons.

```{r echo = FALSE}
AvgJoe %>% select(PlayerYear, height, salary)
```

We can see average salary increased by 1.2 million dollars from 2016 to 2017. Again, this is largely due to the TV deals that was recently signed. The bar graph below shows that the number of players over 7ft tall stayed relatively the same over the 19 seasons. 

```{r echo = FALSE}
tall<-data %>% subset(height_cm >= 210, select = c(PlayerYear, name))
tall_tally <- tall %>% group_by(PlayerYear) %>% summarise(count_name = n())
#tall_tally

ggplot(tall_tally, aes(PlayerYear, count_name)) + 
  geom_bar(stat = "identity", fill = rainbow(n=length(tall_tally$PlayerYear))) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Number of 7ft players") + 
  ggtitle("7fters over 19 years")
```

We can see big men over the height of 7ft(213cm) is still quite rare in the NBA. They only make about 10 percent of the players during each NBA season. However, height can be misleading as taller players usually list themselves shorter at 6ft 9, 10 or 11 on their player card. I decided to change the height requirement to 210 cm. A prime example of player listed height not matching actual height is Kevin Durant who is over 7ft tall but lists himself at 6ft 9 inches. Looking at the trend we can see more big men are taking more 3’s and slimming down.

```{r echo = FALSE, message = FALSE}
tallPlayers<-data %>% filter(height_cm >= 210)
tallPlayers %>% ggplot(aes(PlayerYear, three_att)) + 
  geom_smooth() +
  ggtitle("7ft 3 point attempt Trend")
tallPlayers %>% ggplot(aes(PlayerYear, weight_lb)) + 
  geom_smooth() + 
  ggtitle("7ft Weight Trend")
```

The weight metric is relatively important especially for 7fters and the rest of the NBA players as some teams do have stipulations for salary in contracts for players to stay in shape to play a much faster pace in today’s game. 

```{r echo = FALSE}
tallPlayers %>% ggplot(aes(x = cut(PlayerYear, breaks = 19), salary)) + geom_boxplot() +
  ggtitle("7ft Salary Trend through 19 Seasons")+ 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab("Salary") +
  xlab("Year")
```

For a baseline for players over 7ft, we can see that the average salary didn’t increase that much through the 19 seasons. However, looking at the boxplot we can see an increase of the max.  This indicates a few observations for that year are getting paid bigger contracts then everyone else in the big men observation pool.  The mean salary for 19 seasons is 5322469, min was 55000 and max was 27696430. 

```{r echo = FALSE}
max<-max(tallPlayers$salary)
min<-min(tallPlayers$salary)
median<-median(tallPlayers$salary)
stdev<- sd(tallPlayers$salary)
dftallPlayers <-data.frame()
dftallPlayers <- cbind(rbind(mean,max,min,median,stdev))
colnames(dftallPlayers)[1] <- "Salary"
dftallPlayers
```

```{r echo = FALSE, fig.width=14, fig.height=12}
tall2018<-tallPlayers %>% filter(PlayerYear == 2018) 


tall2018 %>% ggplot(aes(name,salary)) + 
  geom_bar(stat = "identity", fill = rainbow(n=length(tall2018$name))) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  scale_y_continuous(breaks=c(0,5000000,10000000,15000000,20000000,25000000),limits =c(0,25000000)) + 
  ggtitle("2018 7fter Salary Spread")
```

Looking at the 2018 salary spread for big men we can gain better insight on how much a quality big man should be paid under the new 2017 CBA. 

Going off the 2018 contracts for 7fters, we see that the top 5 paid 7fters are Andre Drumond, Hassan Whiteside, Dwight Howard, Brook Lopez and Deandre Jordon command a salary over 20 million dollars a year.
 

```{r echo = FALSE}
tall2018 %>% arrange(desc(salary)) %>% head(n = 10) %>% select(name, salary, ppg, three, t_reb, block)
```

Looking at the top 10 paid 7fters, the value comes from grabbing rebounds and protecting the rim. Looking at the list however, only 2 of these are traditional back to the basket big men. The rest are players who play the pick and roll or pick and pop. This is where they roll to the basket or shoot the 3-pointer or long mid-range 2-pointer. Looking at the salary amount these players are signed at 20-25 percent of the current salary cap which was 99 million dollars for the 2018 season. Depending on the market for numbers of buyers (teams with cap) and sellers (players seeking teams) these types of players could receive up to the max or the salary of a 2nd or 3rd option on a team.

Benefits:

    Signing a modern day big that can spread the floor, shoot 3’s and grab rebounds is a modern day unicorn.  

    Great foundation as genetics cannot be taught or trained.  These types of players should be offered the max and then the super max contract.  

Costs:

    Big men are injury prone.  There were many times during the exploration phase of this report that an injured big man did not play but his salary still counted towards the team that season.  

    Stretch provisions (to stretch a player’s contract over many years) or buyouts(negotiate a buyout of the contract to remove it from the team salary) are very costly and can stranglehold an organization for many years. 
    
    Examples:

      Yao Ming
      Kristaps Porzingis 
      A’mare Stoudamire 
      Dirk Nowitziki 
      Greg Oden


**Foreign Player Salary in the NBA**

With the increase of globalization of the NBA it is important to look at international prospects and players as there might be huge player market outside the United States.

```{r echo = FALSE}
foreign <- data %>% filter(country != "USA")
foreign %>% ggplot(aes(PlayerYear,salary)) +
  geom_bar(stat = "identity", fill = rainbow(n=length(foreign$name))) +
ggtitle("Foreign Salary over the years")
```

Overall salaries paid to international players increased year by year. If we split it by country to see where most of these players are coming from, we see that Spain and France represent most of the international population.

```{r echo = FALSE}
IntandHigh <- data %>% subset(school == "None", select = c(name,salary,country,DraftYear,DraftNum)) %>% 
  arrange(desc(salary))
International <- IntandHigh %>% subset(country != "USA", c(name,salary,country,DraftYear,DraftNum)) %>% 
  arrange(desc(salary))

int_tally <- International %>% group_by(country) %>% 
  summarise(count_country = n(), salary =sum(as.numeric(salary)))

top_10_int<-int_tally %>% arrange(desc(salary)) %>% head(n =10)
top_10_int
ggplot(top_10_int, aes(country,salary)) + 
  geom_bar(stat = "identity", fill = rainbow(n=length(top_10_int$country))) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ggtitle("Top 10 International Countries and their Salaries")
```

France had the most prospects 102.  However, if you look at the salary it looks like Spain produced better prospects than France as the amount of money is quite similar, but Spain only had 68 observations from the 2000-2018 season.  

Spain and France in the past 19 seasons have dominated the European league last 2 decades. For France notable players are Tony parker and Boris Diaw, for Spain they have the Gasol brothers. Spain also arguably has one of the best leagues outside the NBA. La Liga ACB with the most notable team Real Madrid Baloncesto. Because of the age minimum in the NBA it has forced basketball players to look at other options to play professionally before entering the NBA. One of the most recent notable players is Luka Doncic who played one season with Real Madrid before being drafted in the NBA. What makes the Spanish league attractive to players is the actual team doesn’t have a salary cap so the team can spend as much as their team president allows.

The main reason why many players from international leagues can’t make an easier transition to the NBA is they are usually legally obligated to finish out their international contracts with their club. The NBA only allows up to 600,000 dollars for teams to be spend on player contract buyouts. The rest of contract has to be bought out by the player himself. The problem with this is these international players are they are locked into lower rookie contracts which is not enough to cover the cost of their contract with their international club. Teams are allowed more flexibility in contract talks if they allow these players to drop into the 2nd round. However, the team risks the player being drafted by another team. Teams also could just maintain the rights of the player however the wait time for these players to come from oversees can be upwards to 4 years which sacrifices valuable player development time.


```{r echo = FALSE}
mean<-mean(International$salary)
max<-max(International$salary)
min<-min(International$salary)
median<-median(International$salary)
stdev<- sd(International$salary)
dfInternational <-data.frame()
dfInternational <- cbind(rbind(mean,max,min,median,stdev))
colnames(dfInternational)[1] <- "Salary"
dfInternational
```

For a salary scale we see that the mean salary for foreign players is 5,002,830 with max being 25,000,000 per year.  The minimum salary for foreign players the past 19 seasons was 61775, this was probably a 10-day contract or a 2-way contract for a foreign player playing in the developmental league.

Benefit:

    Sign a more mature player.  European players especially can play in the professional league at the age of 15.  They could even attend world events such as the summer Olympic games.  (Ricky Rubio, Beijing 2008)
    
    Access to an international market can bring in more revenue to the team.  

    Retains rights to players and can keep abroad and won’t count towards the salary cap 

Cost:

    600,000-dollar limit to help players with buy outs.  Rookie contracts usually 1-2 mil a year vs a Euro contract that costs 3-4 mil per year.  
    
    No buyout the player has to wait 3-4 years sacrificing valuable player development time.  


**Analysis of the Best and Worst team salaries in the NBA**

```{r echo = FALSE}
#2018
#most wins
win_18 <- data %>% subset(PlayerYear == 2018 & team == "HOU",
                          select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 


#least wins 
lose_18<-data %>% subset(PlayerYear == 2018 & team == "PHO",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 

#2017
#most wins
win_17<-data %>% subset(PlayerYear == 2017 & team == "GSW",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 

#least wins 
lose_17<-data %>% subset(PlayerYear == 2017 & team == "BRK",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins))

#2016
#most wins
win_16<-data %>% subset(PlayerYear == 2016 & team == "GSW",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_16<-data %>% subset(PlayerYear == 2016 & team == "PHI",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2015
#most wins
win_15<-data %>% subset(PlayerYear == 2015 & team == "GSW",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_15<-data %>% subset(PlayerYear == 2015 & team == "MIN",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2014
#most wins
win_14<-data %>% subset(PlayerYear == 2014 & team == "SAS",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_14<-data %>% subset(PlayerYear == 2014 & team == "MIL",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2013
#most wins
win_13<-data %>% subset(PlayerYear == 2013 & team == "MIA",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which.max(salary)],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_13<-data %>% subset(PlayerYear == 2013 & team == "ORL",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2012
#most wins
win_12S<-data %>% subset(PlayerYear == 2012 & team == "SAS",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
win_12C<-data %>% subset(PlayerYear == 2012 & team == "CHI",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins
lose_12<-data %>% subset(PlayerYear == 2012 & team == "CHO",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 

#2011
#most wins
win_11 <-data %>% subset(PlayerYear == 2011 & team == "CHI",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_11<-data %>% subset(PlayerYear == 2011 & team == "MIN",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2010
#most wins
win_10<-data %>% subset(PlayerYear == 2010 & team == "CLE",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_10<-data %>% subset(PlayerYear == 2010 & team == "BRK",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2009
#most wins
win_9<-data %>% subset(PlayerYear == 2009 & team == "CLE",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_9<-data %>% subset(PlayerYear == 2009 & team == "SAC",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2008
#most wins
win_8<-data %>% subset(PlayerYear == 2008 & team == "BOS",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_8<-data %>% subset(PlayerYear == 2008 & team == "MIA",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2007
#most wins
win_7<-data %>% subset(PlayerYear == 2007 & team == "DAL",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_7<-data %>% subset(PlayerYear == 2007 & team == "MEM",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2006
#most wins
win_6<-data %>% subset(PlayerYear == 2006 & team == "DET",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_6<-data %>% subset(PlayerYear == 2006 & team == "POR",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2005
#most wins
win_5<-data %>% subset(PlayerYear == 2005 & team == "PHO",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_5<-data %>% subset(PlayerYear == 2005 & team == "ATL",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2004
#most wins
win_4<-data %>% subset(PlayerYear == 2004 & team == "IND",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_4<-data %>% subset(PlayerYear == 2004 & team == "ORL",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2003
#most wins
win_3<-data %>% subset(PlayerYear == 2003 & team == "SAS",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_3C<-data %>% subset(PlayerYear == 2003 & team == "CLE",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
lose_3D<-data %>% subset(PlayerYear == 2003 & team == "DEN",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2002
#most wins
win_2<-data %>% subset(PlayerYear == 2002 & team == "SAC",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_2G<-data %>% subset(PlayerYear == 2002 & team == "GSW",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
lose_2C<-data %>% subset(PlayerYear == 2002 & team == "CHI",
                         select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2001
#most wins
win_1<-data %>% subset(PlayerYear == 2001 & team == "SAS",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 

#least wins 
lose_1<-data %>% subset(PlayerYear == 2001 & team == "CHI",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#2000
#most wins
win_0<-data %>% subset(PlayerYear == 2000 & team == "LAL",
                       select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 
#least wins 
lose_0<-data %>% subset(PlayerYear == 2000 & team == "LAC",
                        select = name:SalCap) %>% 
  summarize(total = sum(salary),TopPaid = max(salary),
            NameTopSal = name[which(salary == max(salary))],
            highscore = max(ppg), 
            NameTopPpg = name[which.max(ppg)],
            efficient = max(EFG),
            NameTopEFG = name[which.max(EFG)],
            HighPlusMinus = max(PlusMinus),
            NameTopPM = name[which.max(PlusMinus)],
            LeastPaid = min(salary), 
            NameLowSal = name[which.min(salary)],
            AvgSal = mean(salary), 
            tmsalary = median(tmsalary), salcap = median(SalCap),
            OverUnder = (median(tmsalary)/(median(SalCap))), 
            wins = median(TeamWins)) 

#lets look at the trend of winners and losers 
win00_18<-rbind(win_0,win_1,win_2,win_3,win_4,win_5,win_6,win_7,win_8,win_9,win_10,win_11,win_12S, win_12C,
                win_13,win_14,win_15,win_16,win_17,win_18)
win00_18["PlayerYear"]<- c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2012,2013,
                           2014,2015,2016,2017,2018)

#lets see how good teams are sticking with their salary cap
ggplot(win00_18,aes(x=PlayerYear)) +
  geom_line(aes(y = tmsalary), colour = "green") +
  geom_line(aes(y = salcap), colour = "red") +
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018)) +
                     ggtitle("Winning Teams and their Salary Cap")

#totally spending above the cap

##lets look at the losers now 

lose00_18<-rbind(lose_0,lose_1,lose_2C,lose_2G,lose_3C,lose_3D,lose_4,lose_5,lose_6,lose_7,
                 lose_8,lose_9,lose_10,lose_11,lose_12,
                 lose_13,lose_14,lose_15,lose_16,lose_17,lose_18)
lose00_18["PlayerYear"]<- c(2000,2001,2002,2002,2003,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,
                            2014,2015,2016,2017,2018)
#lets see how good teams are sticking with their salary cap
ggplot(lose00_18,aes(x=PlayerYear)) +
  geom_line(aes(y = tmsalary), colour = "green") +
  geom_line(aes(y = salcap), colour = "red") +
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018)) +
  ggtitle("Losing Teams and their salary cap")
```

The green line is the salary for winning teams while the red line is salary for losing teams.  For the past 19 seasons we can see that winning teams spend on average over the salary cap. While losing teams will tend to spend close to the salary cap. Teams who are unable to sign free agents they want, will still have to spend close to the cap according to stipulations in the CBA. If they do not spend close the salary cap for that year, they will have to spread the difference on a pro rata basis between all current players on the team’s roster. This has caused teams who have huge cap space to sign players to ridiculous 1-year contracts just to fill this salary cap space. Another affect this has caused is teams signing average players to contracts close to the max in fear of getting nothing in the free agent market or in the fear of losing their only somewhat productive player to another team. The Celtics avoided this trap by trading away Isaiah Thomas.

  [Isaiah](https://nesn.com/2018/07/why-nba-insider-believes-isaiah-thomas-never-had-shot-at-max-contract/) -The Celtics traded Isaiah to the Cavs instead of giving him the max.  

Armed with this information we as a team or an agent can better advise players for what type of team, they would want to sign with be it a team that is tanking and filling in salary or a contending championship team. Below is the top paid player on the best and worst team through the 2000-2018 season.

```{r echo = FALSE, fig.width=18, fig.height=16}
win00_18["Type"] <- "Winner"
win00_18["team"]<- c("LAL","SAS","SAC","SAS","IND","PHO","DET","DAL","BOS","CLE","CLE",
                     "CHI","SAS","CHI","MIA","SAS","GSW","GSW","GSW","HOU")
lose00_18["Type"] <- "Loser"
lose00_18["team"] <- c("LAC","CHI","CHI","GSW","CLE","DEN","ORL","ATL","POR","MEM","MIA","SAC","BRK",
                       "MIN","CHO","ORL","MIL","NYK","PHI","BRK","PHO")
winvslose <- rbind(win00_18, lose00_18)
#lets look at a comparison of their top player salary
ggplot(winvslose, aes(x = NameTopSal, y = TopPaid, fill = Type)) +
  geom_bar(position = "stack", stat = "identity")  +
  facet_wrap( ~ PlayerYear, scale = "free") +
  ggtitle("Top team player vs Worst team player") 
```

We can see that on average winning teams (teal bar) will spend more for their highest paid player than the losing team (red bar).

```{r echo = FALSE}
#Lets look at a comparison of their average salary 
ggplot(winvslose, aes(x=PlayerYear, y = AvgSal, fill = Type, color = wins)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green") +
  ggtitle("Top team vs Worst team avg player salary") 
```

Looking at the average salary of a player through 19 seasons.  Winning teams (green line) on average spend more than losing teams (red line).  

Now if we split the mark for teams with winning percentages (Teams that won more than 43 games) and teams with losing percentages (Teams that lost more than 42 games). We can see in the 2018 season that teams have spent close to 8 million on average per player while losing teams have spent just above 7 million dollars per player.  However, this average might be pulled up for winning teams due to them signing multiple stars which are only 1-3 players on a team to massive contracts and the rest are minimum paid players.  


```{r echo = FALSE, message = FALSE}
winning <- data %>% filter(TeamWins >= 43)
losing <- data %>% filter(TeamWins <= 42)

winning %>% ggplot(aes(PlayerYear, salary)) + geom_smooth() + 
  ggtitle("Salary on Avg for Players on Winning Teams")

losing %>% ggplot(aes(PlayerYear, salary)) + geom_smooth() +
  ggtitle("Salary on Avg for Players on Losing Teams")
```

Below is a table for the benchmarks differences between winning teams and losing teams for the past 19 seasons. Again, we see more expenditure for teams with winning percentages than losing percentages.  The standard deviation is bigger for the winning team salaries which confirms that the spread of salary of winning teams is more skewed as they are probably signing 1-3 huge contracts with the rest of the 12 contracts on a team being near the minimum.  


```{r echo = FALSE}
mean<-mean(winning$salary)
max<-max(winning$salary)
min<-min(winning$salary)
median<-median(winning$salary)
stdev<- sd(winning$salary)
dfwinning <-data.frame()
dfwinning<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfwinning)[1] <- "Salary Win"
mean<-mean(losing$salary)
max<-max(losing$salary)
min<-min(losing$salary)
median<-median(losing$salary)
stdev<- sd(losing$salary)
dflosing<-data.frame()
dflosing<- cbind(rbind(mean,max,min,median,stdev))
colnames(dflosing)[1] <- "Salary Lose"
cbind(dfwinning,dflosing)
```

Benefits:

    Signing with a losing team usually has more cap space and thus could sign a better deal for the player.  
    
    Losing teams might also give a greater number of years on a contract
    
    Winning team more team chemistry and teams might be able to sign players at a discount

Costs:

    Player on a winning team might not get as much money as he wants as the team’s salary cap will most likely filled by 2 max contract players. (Taking 60 percent of the team salary)

    Signing with a winning team can be instable if you aren’t the star player and many players outside the core players are usually signed to 1- or 2-year contracts.  


**Average salary vs Award Winners Salaries and a look at the Mid-Level exception player**

The Average Joe Player showing points per game, salary, age, total rebounds and assists.

```{r echo = FALSE}
AvgJoe %>% select(ppg,salary,age,t_reb,assist)
```

Average Joe was calculated by taking the mean of all players for every season. If we look at the table, the average joe salary through 2000- 2016 changed from about 100,000 to 600,000 dollars each season. However, going into the new 2017 CBA the average salary increased by about 1.2 million dollars. Which make sense since the 2017 CBA salary scale increased for veterans, rookies that are in the lottery as well as max players.

The average salary increased over the years as well as the average player scoring more points per game.

```{r echo = FALSE}
p1<-ggplot(AvgJoe, aes(PlayerYear, salary, color = ppg)) + geom_line()  +
  scale_colour_gradient(low = "red",high = "green") +
  ggtitle("Avg Joe Salary and PPG")
```

The average salary increased over the years as well as the average player scoring more points per game.


*MVP and DPOY vs Avg Joe*

```{r echo = FALSE}
Avgvs<-AvgJoe %>% subset(Type == "Avg", select = c(PlayerYear,salary,height,plusMinus, 
                                                   mins, ppg, efg, Type))
colnames(Avgvs)[1:8] <- c("PlayerYear", "salary", "height_cm", "PlusMinus", 
                          "MinGames", "ppg", "EFG", "Type")
#MVP
mvpdata<-data %>% subset(mvp == "YES", select =c(PlayerYear, salary, height_cm, PlusMinus,
                                                 MinGames, ppg, EFG))
#mvpdata
mvpdata[,"Type"] <- "MVP"
mvpdatavsAv <- rbind(mvpdata, Avgvs)

ggplot(mvpdatavsAv, aes(x=PlayerYear, y = salary, fill = Type, color = PlusMinus)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green")+
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018)) +
  geom_dl(aes(label = Type), method = list(dl.trans(x = x + 0.2), "last.points", cex = 0.8)) +
  geom_dl(aes(label = Type), method = list(dl.trans(x = x - 0.2), "first.points", cex = 0.8)) +
  ggtitle("MVP vs Avg Joe")
```

MVP salary of course is above the average joe salary. Winning the MVP award allows players to get the maximum contract. Other ways to obtain the max contract including making the All-NBA team consistently. This is in the CBA called the designated player exception.

The designated player exception: Applies to players that have 7 to 9 years of NBA experience. It allows players to get paid the max which is 35 percent of the current salary cap. Players before needed to be 10 years in the league before making 35 percent. (7 to 9 made 30, 0 to 6 made 25 percent of the salary cap.)

The requirements also are that the player must make two All-NBA teams or win defensive player of the year or MVP 3 years prior to signing the deal. We can see defensive player of the year salary is well above average Joe as well.


```{r echo = FALSE}
#DPOY
dpoydata<-data %>% subset(dpoy == "YES", select =c(PlayerYear, salary, height_cm, PlusMinus,
                                                   MinGames, ppg, EFG))
dpoydata[,"Type"] <- "DPOY"
dpoydatavsAv <- rbind(dpoydata, Avgvs)

#dpoydata

ggplot(dpoydatavsAv, aes(x=PlayerYear, y = salary, fill = Type, color = PlusMinus)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green")+
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018)) +
  geom_dl(aes(label = Type), method = list(dl.trans(x = x + 0.2), "last.points", cex = 0.8)) +
  geom_dl(aes(label = Type), method = list(dl.trans(x = x - 0.2), "first.points", cex = 0.8)) +
  ggtitle("DPOY vs Avg Joe")

```

  [CBA](https://www.foxsports.com/nba/story/nba-6-important-aspects-of-the-new-collective-bargaining-agreement-122016) - Explaining the collective bargaining agreement and different contract rules.

The Derrick Rose rule allows rookies to sign for 30 percent of the team salary cap if they were voted to the all-star game twice and got on two All-NBA teams. Winning the MVP would also qualify the player to get 30 percent of the salary cap.

```{r echo = FALSE}
mean<-mean(mvpdata$salary)
max<-max(mvpdata$salary)
min<-min(mvpdata$salary)
median<-median(mvpdata$salary)
stdev<- sd(mvpdata$salary)
dfmvpdata <-data.frame()
dfmvpdata<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfmvpdata)[1] <- "Salary MVP"
mean<-mean(dpoydata$salary)
max<-max(dpoydata$salary)
min<-min(dpoydata$salary)
median<-median(dpoydata$salary)
stdev<- sd(dpoydata$salary)
dfdpoydata<-data.frame()
dfdpoydata<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfdpoydata)[1] <- "Salary DPOY"
cbind(dfmvpdata,dfdpoydata)
```

We can see that MVPs make more money than players that win defensive player of the year.  However, it is important to note some MVP’s have also won DPOY.  While the difference doesn’t look that big between the salaries of DPOY and MVP the salary difference for playing defense and putting a good show on offense becomes more apparent when we look at the All-NBA team vs the All-defensive team. 

*All-NBA and All-Defensive teams*

```{r echo = FALSE}
allnba<-data %>% filter(nba1 =="YES"|nba2=="YES"|nba3=="YES") 

#allnba %>% ggplot(aes(PlayerYear, salary)) + geom_smooth()+
  #scale_color_gradient(low = "green", high = "red")

allnba %>% ggplot(aes(ppg, salary, color = assist, size =2)) + geom_point() +  
  scale_color_gradient(low = "green", high = "red")
```

For All-NBA teams I looked at salary plotted with ppg and assists.  The All-NBA team voting is widely evaluated by the media on a player’s offensive statistics and number wins.  Since, the removal of the center position in the voting ballots a lot of these awards go to forwards and guards now.  

```{r echo = FALSE}
#allnba %>% filter(ppg>= 30 & assist >=9)
alldef <- data %>% filter(def1 == "YES" | def2 == "YES") 

#alldef %>% ggplot(aes(PlayerYear, salary)) + geom_smooth()
alldef %>% ggplot(aes(t_reb, salary, color = steal, size = 3)) + geom_point()+
  scale_color_gradient(low = "green", high = "red") 
```

For the all-defense team I chose to plot salary with total rebounds and steals.  Guards being able to easily get steals and big men being able to easily get rebounds.  Of course, since this is a media chosen award, there are other non-measurable statistics on defense.   For example, Bruce Bowen, Raja Bell, Avery Bradley and Shane Battier all considered good role players might not even grab a single rebound or make a single steal, but they are able to hold the opposing player to a lower shooting percentage.  Thus, the all-defensive team might comprise of only a few role players in the award listing.  

All-NBA players seem to receive a higher salary than All-Defense players. In NBA contracting through the agreements of the CBA there doesn’t seem to be a salary increase for players who make it to all defensive teams. If we look at the salary scale of an All-NBA player, we see that the mean salary is 14752955, max salary is 34682550, min salary is 2157595 and median salary is 14693906. Looking at the all-defensive team, the mean salary is 12274335, max salary is 28000000, min salary is 715850 and median salary is 12289544. All-NBA players are more recognized through the media and usually get voted in the yearly all-star games more often than players who are on the all-defensive team. It is important to note that most of these award voting is done not by the coaches and league players who actually play the game but the media people who cover and report interesting stories and headlines on the NBA.

```{r echo = FALSE}
mean<-mean(allnba$salary)
max<-max(allnba$salary)
min<-min(allnba$salary)
median<-median(allnba$salary)
stdev<- sd(allnba$salary)
dfallnba <-data.frame()
dfallnba<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfallnba)[1] <- "Salary All_NBA"
mean<-mean(alldef$salary)
max<-max(alldef$salary)
min<-min(alldef$salary)
median<-median(alldef$salary)
stdev<- sd(alldef$salary)
dfalldef<-data.frame()
dfalldef<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfalldef)[1] <- "Salary All_Def"
cbind(dfallnba,dfalldef)
```


The benefits are clear for trying to sign the league MVP or DPOY.  With most teams acknowledging these types of players should get the max.  All-NBA players for consecutive years before a contract signing will be able to sign for a higher max, however all-defensive players might just be role players and might sign close to league average or the mid – level exception.  

*The mid-level exception player*

The Mid-level exception is probably one of the most interesting salary exceptions allowed in the NBA. It allows teams that are at their salary cap to still sign a player at that year’s average salary. There are 3 types of mid-level exceptions.

The non-taxpayer mid-level exception, the taxpayer mid-level exception and the room mid-level exception. The non-taxpayer mid-level exception is for teams that are under that luxury tax apron which is 4 million dollars above the tax line. The amount and number of years that the player can be signed for is much less than the non-taxpayer mid-level exception. The room mid-level exception is for teams under the cap and the exception amount is the lowest as well as the number of years a player can be signed to this exception.

Before the 2011 CBA the mid-level exception was tied to salary cap. It was the average salary for all teams over the salary cap during that season. Past 2011 it has been a fixed amount each year. The mid-level exception can be used on multiple players as well.

```{r echo = FALSE, fig.width=14, fig.height=12}
#Mid level exception 

# the med level exception lets go with if you are over the salarycap and are a taxpayer since we want to compete for a winning season
#for salaries lets go 25 percent under and over for negotiation skills 
#5,192,000
med_2018 <- subset(data, PlayerYear==2018 & salary <= 6490000 & salary >= 3894000 & DraftYear != 2018 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,477,000
med_2017 <- subset(data, PlayerYear==2017 & salary <= 4346250 & salary >= 2607750 & DraftYear != 2017 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,376,000
med_2016 <- subset(data, PlayerYear==2016 & salary <= 4220000 & salary >= 2532000 & DraftYear != 2016 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,278,000
med_2015 <- subset(data, PlayerYear==2015 & salary <= 4097500 & salary >= 2458500 & DraftYear != 2015 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,183,000
med_2014 <- subset(data, PlayerYear==2014 & salary <= 3978750 & salary >= 2387250 & DraftYear != 2014 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,090,000
med_2013 <- subset(data, PlayerYear==2013 & salary <= 3862500 & salary >= 2317500 & DraftYear != 2013 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
#3,000,000
med_2012 <- subset(data, PlayerYear==2012 & salary <= 3750000 & salary >= 2250000 & DraftYear != 2012 & Age > 23 ,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
# Before the 2011 CBA, the MLE was equal to the average NBA salary for all teams over the cap
# mutate 

midexc2011<-subset(data, PlayerYear==2011 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2011$salary)

#4990128 
med_2011 <- subset(data, PlayerYear==2011 & salary <= 6237660 & salary >= 3742596 & DraftYear != 2011 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))


midexc2010<-subset(data, PlayerYear==2010 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2010$salary)

#5055895
med_2010 <- subset(data, PlayerYear==2010 & salary <= 6319868 & salary >= 3791921 & DraftYear != 2010 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))

midexc2009<-subset(data, PlayerYear==2009 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2009$salary)
#4927921
med_2009 <-subset(data, PlayerYear==2009 & salary <= 6159901 & salary >= 3695940 & DraftYear != 2009 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2008<-subset(data, PlayerYear==2008 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2008$salary)
#4791522
med_2008 <- subset(data, PlayerYear==2008 & salary <= 5989402 & salary >= 3593641 & DraftYear != 2008 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
midexc2007<-subset(data, PlayerYear==2007 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2007$salary)
#4459748
med_2007 <- subset(data, PlayerYear==2007 & salary <= 5574685 & salary >= 3344811 & DraftYear != 2007 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
midexc2006<-subset(data, PlayerYear==2006 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2006$salary)
#4475003
med_2006 <- subset(data, PlayerYear==2006 & salary <= 5593753 & salary >= 3356252 & DraftYear != 2006 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))
midexc2005<-subset(data, PlayerYear==2005 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2005$salary)
#4297463
med_2005 <-subset(data, PlayerYear==2005 & salary <= 5371828 & salary >= 3223097 & DraftYear != 2005 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2004<-subset(data, PlayerYear==2004 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2004$salary)
#4113290
med_2004 <-subset(data, PlayerYear==2004 & salary <= 5141612 & salary >= 3084967 & DraftYear != 2004 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2003<-subset(data, PlayerYear==2003 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2003$salary)
#3844233
med_2003 <-subset(data, PlayerYear==2003 & salary <= 4805291 & salary >= 2883174 & DraftYear != 2003 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2002<-subset(data, PlayerYear==2002 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2002$salary)
#3674357
med_2002 <-subset(data, PlayerYear==2002 & salary <= 4592946 & salary >= 2755767 & DraftYear != 2002 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2001<-subset(data, PlayerYear==2001 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2001$salary)
#3642971
med_2001 <-subset(data, PlayerYear==2001 & salary <= 4553713 & salary >= 2732228 & DraftYear != 2001 & Age > 23,
                  select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                             started))
midexc2000<-subset(data, PlayerYear==2000 & overUnder > 1.05,
                   select = c(team, tmsalary, salary))
#mean(midexc2000$salary)
#3084692
med_2000 <- subset(data, PlayerYear==2000 & salary <= 3855865 & salary >= 2313519 & DraftYear != 2000 & Age > 23,
                   select = c(name,PlayerYear,salary,height_cm,PlusMinus,MinGames, ppg, EFG, Games,
                              started))


mr_med <-rbind(med_2018, med_2017, med_2016, med_2015, med_2014, med_2013,
               med_2012, med_2011, med_2010, med_2009, med_2008, med_2007,
               med_2006, med_2005, med_2004, med_2003, med_2002, med_2001, med_2000)
notable_med<-mr_med %>% subset(ppg >= 10 & PlusMinus >= 5 & MinGames >= 15 & Games >= 40, 
                  select = c(name, ppg, PlusMinus, MinGames, Games, PlayerYear))
#head(notable_med, n = 10)
#these are some of the notable names that could have been signed for the mid level exception. 
#of course not that accurate because damian lilard and klay thompson shouldn't be on this list.

```

```{r echo = FALSE}
#lets look at the mean average of med exception players vs the average players over the years 

med_2018a<- med_2018 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2017a<- med_2017 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2016a<- med_2016 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2015a<- med_2015 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2014a<- med_2014 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2013a<- med_2013 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2012a<- med_2012 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2011a<- med_2011 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2010a<- med_2010 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2009a<- med_2009 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2008a<- med_2008 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2007a<- med_2007 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2006a<- med_2006 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2005a<- med_2005 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2004a<- med_2004 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2003a<- med_2003 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2002a<- med_2002 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2001a<- med_2001 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))
med_2000a<- med_2000 %>% summarize(PlayerYear=mean(PlayerYear), salary = mean(salary), height_cm = mean(height_cm),
                                   PlusMinus = mean(PlusMinus), MinGames = mean(MinGames), ppg = mean(ppg),
                                   EFG = mean(EFG))

mr_meda <-rbind(med_2018a, med_2017a, med_2016a, med_2015a, med_2014a, med_2013a,
               med_2012a, med_2011a, med_2010a, med_2009a, med_2008a, med_2007a,
               med_2006a, med_2005a, med_2004a, med_2003a, med_2002a, med_2001a, med_2000a)
#mr_meda
mr_meda[,"Type"] <- "MED"
mr_medavsAv <- rbind(mr_meda, Avgvs)

ggplot(mr_medavsAv , aes(x=PlayerYear, y = salary, fill = Type, color = ppg)) +
  geom_line() +
  scale_colour_gradient(low = "red",high = "green")+
  scale_x_continuous(breaks=c(2000,2002,2004,2006,2008,2010,2012,2014,2016,2018), 
                     limits =c(2000,2018))+
  geom_dl(aes(label = Type), method = list(dl.trans(x = x + 0.2), "last.points", cex = 0.8)) +
  geom_dl(aes(label = Type), method = list(dl.trans(x = x - 0.2), "first.points", cex = 0.8)) +
  ggtitle("Mid Level Except vs AvgJoe")
```

Data online for players signed by the mid-level exception wasn’t available for the last 19 seasons. What I wanted to analyze with the mid-level exception was what players each year teams could potentially sign with the mid- level exception when they were near the salary cap. The mid-level exception line above was created by taking the mid-level exception each year and selecting players whose salaries were 25 percent lower or above this mid-level exception salary number. While, of course there could be players who will be willing to take a massive pay cut to play for certain teams, this isn’t something that normally would happen on average. (David West rejected 12.5 million dollars a year to accept the veteran’s minimum with the Spurs.)

  [David West](https://www.businessinsider.com/nba-david-west-spurs-pay-cut-2015-9)– Gave up 11 million dollars to sign with a contender.  

It is interesting to see that players before the 2011 CBA before a fixed number was set for the mid-level exception, were able to sign better quality players on average. However, after the 2011 CBA we can see the quality drops significantly if we compare the mid- level exception player to the average players ppg we can see there is a drop off perhaps due to the salary drop.


```{r echo = FALSE}
mean<-mean(mr_med$salary)
max<-max(mr_med$salary)
min<-min(mr_med$salary)
median<-median(mr_med$salary)
stdev<- sd(mr_med$salary)
dfmr_med<-data.frame()
dfmr_med<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfmr_med)[1] <- "Salary Mid Level"
mean<-mean(AvgJoe$salary)
max<-max(AvgJoe$salary)
min<-min(AvgJoe$salary)
median<-median(AvgJoe$salary)
stdev<- sd(AvgJoe$salary)
dfAvgJoe<-data.frame()
dfAvgJoe<- cbind(rbind(mean,max,min,median,stdev))
colnames(dfAvgJoe)[1] <- "Salary Avg Joe"
cbind(dfmr_med,dfAvgJoe)
```

Looking at min, max, median, mean and standard deviation, we can see that there isn’t much of a difference if you compare using the 2000-2018 season data.

Benefit:

    Signing a player to the mid-level exception allows players who are over the cap to sign a player that is not account towards their current team salary.  

Cost:

    Since, the change of how the mid-level exception is calculated from a percentage of the salary cap to now a fixed amount every year.  The average salary or signing on the free-agent market is higher than what the MLE can offer.  Thus, you might not get the player you want due to another team offering him a bigger contract.  
 

### **Multiple Linear Regression model and Decision Tree analysis** 

To attempt to build a model to predict salary I used a multiple linear regression model. For the training set I used the 2000-2014 season and for the test set the 2015-2018 season was used.

The first model used age, total rebounds, points per game, games played minutes per game, number of years and two-point shots made. I then removed two-pointers made since it wasn’t significant to the model. The adjusted R squared from that model was approximately 0.53 which means 0.47 wasn’t predicted by the model.

I then wanted to test for multicollinearity, so I ran a correlation test to see which explanatory variables were highly correlated with each other.  


```{r echo= FALSE}
nbaTrain<- data %>% subset(PlayerYear == 2000|PlayerYear == 2001|PlayerYear == 2002|PlayerYear == 2003|
                  PlayerYear == 2004|PlayerYear == 2005|PlayerYear == 2006|PlayerYear == 2007|
                  PlayerYear == 2008|PlayerYear == 2009 |PlayerYear == 2010 | PlayerYear == 2011|
                    PlayerYear == 2012| PlayerYear == 2013 | PlayerYear == 2014, select =c(PlayerYear, team, name, salary,
                                                                   height_cm, weight_lb, school,
                                                                   country,DraftYear, DraftRound,
                                                                   DraftNum, PlusMinus, Pos, Age,
                                                                   Games, started, MinGames,
                                                                   FG, FG_att, three, three_att,
                                                                   two, two_att, FT, FT_att,
                                                                   o_reb, d_reb, t_reb, assist,
                                                                   steal, block, TO, fouls, ppg,
                                                                   infl, mvp,mip,SixthMan,dpoy,
                                                                   roy, nba1, nba2, nba3, rook1, rook2,
                                                                   def1,def2, FG_per, two_per, EFG,
                                                                   three_per, FT_per, TeamWins, NumYears,
                                                                   tmsalary, SalCap, overUnder))
nbaTest <- data %>% subset(PlayerYear == 2015|PlayerYear == 2016| PlayerYear == 2017 | PlayerYear == 2018, 
                           select =c(PlayerYear:overUnder))
```


```{r echo = FALSE}
#Looking for multicollinearity
myvars = c("Age","t_reb", "FG", "ppg", "Games", "MinGames", "NumYears")
dfTrain<-nbaTrain[myvars]
#dfTrain

round(cor(dfTrain),2)

#scatterplot
plot(dfTrain)
```

If the correlations between two explanatory variables was above 0.8 there would be a high chance of multicollinearity in the model. Field goal and points per game had a correlation of 0.99, while minutes per game, field goals and points per game had a 0.9 correlation. But before just removing these variables from the model I used a variance of inflation factor test from the cars package.  

```{r echo = FALSE}
nbaMacModel2 <- lm(salary~Age + t_reb + FG + ppg + Games + MinGames +NumYears, data=nbaTrain)
vif(nbaMacModel2)

#FG is 56 lets remove that first 

#remove Minutes per game 

nbaMacModel4 <- lm(salary~Age + t_reb +Games + ppg + NumYears, data=nbaTrain)
summary(nbaMacModel4)

vif(nbaMacModel4)
SSE <- sum(nbaMacModel4$residuals^2)
#SSE
RMSE <- sqrt(SSE/nrow(nbaTrain))
RMSE
```

Variance inflation is calculated as 1/tolerance where tolerance is the percent of variance in the predictor that cannot be accounted for by other predictors. We wanted to have a VIF score to be close to 1 but under 5. However, we did not want a VIF over 10 which means this variable was not needed and could be removed from the model.

Field goals had a VIF score of 55.8. Field goals was removed, and I remade the model again with field goals removed and ran the VIF test again. I then removed minutes per game which had a VIF score of 7.4. We then arrived at a model where all the VIF scores were below 5 and close to 1. 

The final model before running the test for the homoscedasticity assumption had a R squared of 0.5287 with a RMSE of 2990696.  

To check if the error terms were normally distributed, I ran a plot of the model.   While the error terms were normally distributed by plotting it on a histogram, when I plotted it using plot().  The residuals were expanding as x increased.  Thus, our assumption of homoscedasticity failed.  The BP-Test confirmed heteroscedasticity.  


*Box Cox Transformation of Salary*

To fix this I ran a Box Cox Transformation.  Where I chose a lamda of 0.2 based off the graph. 

```{r echo = FALSE}
boxCox(nbaMacModel4, lambda = seq(-1,1,.05))
```

I chose a lamba of 0.2 to transform salary when looking at this chart.

```{r echo = FALSE}
nbaMacModel4Trans <- lm(salary ^(.20)~Age + t_reb +Games + ppg + NumYears, data=nbaTrain)
summary(nbaMacModel4Trans);extractAIC(nbaMacModel4Trans)[2]
```

For the box-cox transformation model the adjusted R-squared was 0.5496 which was an improvement over the original model. The RMSE also decreased from the original model. From 2990696 to 12933.74. The residuals became constant indicating that the model no longer suffers from heteroscedasticity.

Using plot() the new model shows that heteroscedasticity was fixed.  Our new R squared (0.5496) vs old (0.5287).  

```{r echo = FALSE}
plot(nbaMacModel4Trans)
```

If we look at the first plot. As X increases the errors don’t increase but stay relatively constant. Normal QQ shows the that it almost falls on the line, this tells us that our errors look normally distributed.  I double check this with a histogram below. 

```{r echo = FALSE}
std.res<-rstudent(nbaMacModel4Trans)
hist(std.res, freq=FALSE,
     main = "Distribution of Studentized Residuals")
xfit<- seq(min(std.res),max(std.res),length =50)
yfit<-dnorm(xfit)
lines(xfit,yfit,col='red')
```

When running the model with the test data (2015-2018), the R squared got worst and dropped to 0.44, while the RMSE went up.   This was kind of expected due to the 2017 CBA and expansion of the television contracts leading up to this agreement.  

```{r echo = FALSE}
nbaTest2 <-nbaTest
nbaTest2$salary<- (nbaTest2$salary) ^ (0.2)

salarypred <- predict(nbaMacModel4Trans, nbaTest2)

rmse <- sqrt(mean((nbaTest2$salary) ^(1/0.2)- (salarypred)^(1/0.2))^2) 
#rmsenew 


SSEnew <- sum((salarypred - nbaTest2$salary)^2)
SSTnew <- sum((mean(nbaTrain$salary)^(0.2) - nbaTest2$salary)^2)
R2 <- 1 - SSEnew/SSTnew
mean<- mean(nbaTest$salary)
#R2new
rmseold <- sqrt(mean((nbaTest$salary) - (salarypred))^2)
R2old<- 0.5496
meanold<-mean(nbaTest$salary)
#rmseold
```


```{r echo = FALSE}

dfmodelBC<-data.frame()
dfmodelBC<- cbind(rbind(rmse,R2,mean))
colnames(dfmodelBC)[1] <- "Box Cox Transformation"
dfmodelBC
```

Other factors outside are explanatory variables outside of the data on player statistics is explaining approximately 56 percent of salary. 

Possible Explanatory Variables outside player statistics and team wins:

1.	Basketball related income

    a)	How new business models such as the rise of social media and ad income might affect this number.
    
    b)	How the percentage is calculated it fell from 57 percent to 51 percent but the players overall got more money due to the salary cap increase.

2.	Team Chemistry and Organization Chemistry

    a)	Players might enjoy playing for an organization and take discounts
    
    b)	He might want to play with other players he chooses and decides to take a pay cut

3.	Income outside of basketball

    a)	As more international brands try to enter the NBA, fewer known players can get shoe deals from outside the big shoe brands like Nike and Adidas. 

    b)	Players can be actively involved in outside investments setup by their sports agent or investment firm



### *Conclusion*

The goal of this report was to establish a baseline or a cost guide for teams, players or agents to use in the salary negotiation process. We were able to develop baselines from exploring trends in the NBA looking at important metrics like 3 pointers made and if the client or player was 7ft tall what type of salary landscape they would expect. We also explored the cost guide/salary guide for an abroad player and what expectations of what the team or the player could expect. The data then found that award winners which is awarded by the media got more salary than the average player.

The last thing we did was run a regression model. What we found in the regression model was that there were other variables outside the explanatory variables put in the model that might do a better job in predicting player salary. These factors could be the new compensation structure in the 2017 CBA, individual team bonus structure for specific players, player pension with the NBA and their team, player branding outside the scope of the NBA revenue system, the increased power of the players association.

To better improve our or future models we would most likely want to develop a few variables that account for new agreements of the collective bargaining agreement that happens every 6 – 10 years. Another improvement we could make is create a social power index for players based on their Instagram or twitter following. We would also want to take into account the agency the player is being represented by and perhaps give each sports agency a grading system based on historical signings for the last 20 years. Another feature if I had more time to do this with more resources is to structure the data of the NBA players contract to indicate how many years left the player has on his contract and whether the contract has a player option, team option or if the team has the Birds rights to the player.
 


